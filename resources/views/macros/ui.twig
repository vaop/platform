{#
 # UI helper macros
 #}

{# Badge/tag #}
{% macro badge(text, options = {}) %}
    {% set variant = options.variant|default('secondary') %}
    {% set size = options.size|default('') %}

    {% set variantMap = {
        'gray': 'secondary',
        'red': 'danger',
        'yellow': 'warning',
        'green': 'success',
        'blue': 'info',
        'indigo': 'primary',
        'purple': 'primary',
        'pink': 'primary'
    } %}

    {% set badgeVariant = variantMap[variant]|default(variant) %}
    {% set sizeClass = size ? 'badge-' ~ size : '' %}

    <span class="badge badge-{{ badgeVariant }} {{ sizeClass }}">
        {{ text }}
    </span>
{% endmacro %}

{# Status indicator dot #}
{% macro status(status, label = '') %}
    {% set statusColors = {
        'online': 'var(--color-success)',
        'offline': 'var(--color-text-muted)',
        'busy': 'var(--color-danger)',
        'away': 'var(--color-warning)'
    } %}

    <span class="cluster cluster-2">
        <span style="width: 0.5rem; height: 0.5rem; border-radius: 50%; background-color: {{ statusColors[status]|default('var(--color-text-muted)') }};"></span>
        {% if label %}
            <span class="text-small text-muted">{{ label }}</span>
        {% endif %}
    </span>
{% endmacro %}

{# Avatar/profile image #}
{% macro avatar(options = {}) %}
    {% set src = options.src|default('') %}
    {% set alt = options.alt|default('Avatar') %}
    {% set size = options.size|default('md') %}
    {% set initials = options.initials|default('') %}

    {% set sizes = {
        'xs': '1.5rem',
        'sm': '2rem',
        'md': '2.5rem',
        'lg': '3rem',
        'xl': '4rem'
    } %}

    {% set sizeValue = sizes[size]|default('2.5rem') %}

    {% if src %}
        <img src="{{ src }}" alt="{{ alt }}" style="width: {{ sizeValue }}; height: {{ sizeValue }}; border-radius: 50%; object-fit: cover;">
    {% else %}
        <span class="flex-center" style="width: {{ sizeValue }}; height: {{ sizeValue }}; border-radius: 50%; background-color: var(--color-secondary); color: var(--color-text-inverted); font-weight: 500;">
            {{ initials }}
        </span>
    {% endif %}
{% endmacro %}

{# Loading spinner #}
{% macro spinner(options = {}) %}
    {% set size = options.size|default('md') %}

    {% set sizes = {
        'sm': '1rem',
        'md': '1.5rem',
        'lg': '2rem'
    } %}

    {% set sizeValue = sizes[size]|default('1.5rem') %}

    <svg style="width: {{ sizeValue }}; height: {{ sizeValue }}; animation: spin 1s linear infinite; color: var(--color-primary);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path style="opacity: 0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
{% endmacro %}

{# Empty state #}
{% macro empty(options = {}) %}
    {% set title = options.title|default('No items') %}
    {% set description = options.description|default('') %}
    {% set icon = options.icon|default('inbox') %}

    {% set icons = {
        'inbox': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>',
        'document': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>',
        'users': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>'
    } %}

    <div class="section-lg" style="text-align: center;">
        <svg style="margin: 0 auto; width: 3rem; height: 3rem; color: var(--color-text-muted);" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            {{ icons[icon]|default(icons.inbox)|raw }}
        </svg>
        <h3 class="heading-sm" style="margin-top: 0.5rem;">{{ title }}</h3>
        {% if description %}
            <p class="text-small text-muted" style="margin-top: 0.25rem;">{{ description }}</p>
        {% endif %}
        {% block action %}{% endblock %}
    </div>
{% endmacro %}

{# Progress bar #}
{% macro progress(value, options = {}) %}
    {% set max = options.max|default(100) %}
    {% set variant = options.variant|default('primary') %}
    {% set showLabel = options.showLabel|default(false) %}

    {% set percentage = (value / max) * 100 %}

    {% set colorVars = {
        'primary': 'var(--color-primary)',
        'success': 'var(--color-success)',
        'danger': 'var(--color-danger)',
        'warning': 'var(--color-warning)'
    } %}

    <div style="width: 100%;">
        {% if showLabel %}
            <div class="flex-between" style="margin-bottom: 0.25rem;">
                <span class="text-small">{{ value }}/{{ max }}</span>
                <span class="text-small text-muted">{{ percentage|number_format(0) }}%</span>
            </div>
        {% endif %}
        <div style="width: 100%; background-color: var(--color-border-muted); border-radius: var(--radius-full); height: 0.5rem;">
            <div style="background-color: {{ colorVars[variant]|default('var(--color-primary)') }}; height: 0.5rem; border-radius: var(--radius-full); width: {{ percentage }}%;"></div>
        </div>
    </div>
{% endmacro %}
